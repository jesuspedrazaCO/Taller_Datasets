# -*- coding: utf-8 -*-
"""Proyecto Airbnb Python y pandas.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1F_OKdyQL6p4otvsxtxTl9wU_eq2xCMch
"""

import pandas as pd

df = pd.read_csv('AirbnbNY.csv', header=0)

df

# 1. ¿Qué relación existe entre la ubicación (latitud, longitud) y el precio promedio por noche en cada grupo de barrios?

def relacion_ubicacion_precio(df):
    grouped = df.groupby('neighbourhood_group').agg({
        'latitude': 'mean',
        'longitude': 'mean',
        'price': 'mean'
    }).rename(columns={'price': 'avg_price_per_night'})
    return grouped

result_1 = relacion_ubicacion_precio(df)
print(result_1)

# 2. ¿Existen diferencias significativas en los precios y disponibilidad entre los alojamientos con más de 50 reseñas y aquellos con menos de 10?

def diferencias_precios_disponibilidad(df):
    high_reviews = df[df['number_of_reviews'] > 50].agg({'price': 'mean', 'availability_365': 'mean'})
    low_reviews = df[df['number_of_reviews'] < 10].agg({'price': 'mean', 'availability_365': 'mean'})
    return pd.DataFrame({'high_reviews': high_reviews, 'low_reviews': low_reviews})

result_2 = diferencias_precios_disponibilidad(data)
print(result_2)

# 3. ¿Qué barrios tienen las propiedades más disponibles al año (mayor disponibilidad 365 promedio) y cómo se relacionan con el precio promedio y el tipo de habitación?

def barrios_mayor_disponibilidad(df):
    grouped = df.groupby('neighbourhood').agg({
        'availability_365': 'mean',
        'price': 'mean',
        'room_type': lambda x: x.mode()[0]
    }).rename(columns={'availability_365': 'avg_availability', 'price': 'avg_price'})
    top_neighbourhoods = grouped.sort_values('avg_availability', ascending=False).head(5)
    return top_neighbourhoods

result_3 = barrios_mayor_disponibilidad(data)
print(result_3)

# 4. ¿Cuáles son las características más comunes (precio, disponibilidad, reseñas, etc.) de los alojamientos en barrios con más de 500 listados activos?

def caracteristicas_comunes(df):
    high_listings = df.groupby('neighbourhood').filter(lambda x: len(x) > 500)
    summary = high_listings.agg({
        'price': 'mean',
        'availability_365': 'mean',
        'number_of_reviews': 'mean',
        'calculated_host_listings_count': 'mean'
    }).rename({
        'price': 'avg_price',
        'availability_365': 'avg_availability',
        'number_of_reviews': 'avg_reviews',
        'calculated_host_listings_count': 'avg_listings_count'
    })
    return summary

result_4 = caracteristicas_comunes(data)
print(result_4)

# 5. ¿Cuáles son los cinco barrios más populares en términos de número total de reseñas, y cómo varía el precio promedio en estos barrios?

def barrios_mas_populares(df):
    popular_neighbourhoods = df.groupby('neighbourhood').agg({
        'number_of_reviews': 'sum',
        'price': 'mean'
    }).rename(columns={'number_of_reviews': 'total_reviews', 'price': 'avg_price'})
    top_neighbourhoods = popular_neighbourhoods.sort_values('total_reviews', ascending=False).head(5)
    return top_neighbourhoods

result_5 = barrios_mas_populares(data)
print(result_5)